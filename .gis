syspip install numpy  # required for postgis



#If you don't have Postgres installed yet:
# https://github.com/tsaleh/tammer-saleh/blob/master/views/posts/installing-postgresql-for-rails-3-1-on-lion.html.textil

# Django 1.4 doesn't support postgis 2.x
# postgres 9.2 doesn't support postgis 1.5.x
# So, we need to install postgres 9.1 and postgis 1.5

#1. Install Postgres 9.1.5.
brew install postgres https://github.com/mxcl/homebrew/commit/1c8c93633f446ef0ddff553d5081cd0548c91687#Library/Formula/postgresql.rb
initdb -E utf8
brew install gdal --with-postgres

# install geos 3.3.5
brew install geos https://github.com/mxcl/homebrew/commit/933ef026bcff0bf441f3a864c9c7590a9fbba265#Library/Formula/geos.rb

#2. Install postgis 1.5.3. Latest is 2.0.0, so using url old formula on github
brew install https://raw.github.com/mxcl/homebrew/8a04a43763906e6a9bef68881acf997f3a6f6687/Library/Formula/postgis.rb


#3. Create a template to be used on creating GIS-enabled databases
createdb template_postgis


#4. Import Postgis Data
psql -d template_postgis -f /usr/local/Cellar/postgis/1.5.3/share/postgis/postgis.sql
psql -d template_postgis -f /usr/local/Cellar/postgis/1.5.3/share/postgis/spatial_ref_sys.sql

#Test if works
psql -d template_postgis -c "SELECT postgis_full_version();"


#5. Set template permissions to marc
createuser -R -S -L -D -I marc;

psql -d template_postgis
ALTER DATABASE template_postgis OWNER TO marc;
ALTER TABLE geometry_columns OWNER TO marc;
ALTER TABLE spatial_ref_sys OWNER TO marc;
CREATE SCHEMA gis_schema AUTHORIZATION marc;
\q


#6. Adds your app's user
createuser -i -l -S -R -d <app_user>

psql -d postgres
GRANT marc TO <app_user>;
\q


#7. Create your app database
createdb -T template_postgis -O <app_user> <app_db>;


#8. Install mapnik
brew install mapnik --with-gdal --with-geos


#brew install --HEAD osm2pgsql
